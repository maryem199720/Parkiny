<div class="reservation-container">
  <div class="reservation-header">
    <h2>Réservation de parking premium</h2>
    <p>Choisissez et réservez votre place en quelques clics</p>
  </div>

  <!-- Stepper -->
  <div class="stepper">
    <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
      <div class="step-number">1</div>
      <div class="step-label">Choix de la place</div>
    </div>
    <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
      <div class="step-number">2</div>
      <div class="step-label">Détails</div>
    </div>
    <div class="step" [class.active]="currentStep === 3">
      <div class="step-number">3</div>
      <div class="step-label">Confirmation</div>
    </div>
  </div>

  <!-- Step 1: Place Selection -->
  <div *ngIf="currentStep === 1" class="step-content">
    <div class="map-section">
      <div class="map-header">
        <h3><mat-icon>map</mat-icon> Plan du parking</h3>
        <div class="legend">
          <span class="legend-item"><span class="color-box standard"></span> Standard</span>
          <span class="legend-item"><span class="color-box premium"></span> Premium</span>
          <span class="legend-item"><span class="color-box handicap"></span> Handicap</span>
          <span class="legend-item"><span class="color-box reserved"></span> Réservé</span>
        </div>
      </div>
      <div class="parking-lot">
        <div *ngFor="let place of availablePlaces" 
             class="parking-space"
             [class.selected]="place.selected"
             [class.reserved]="place.reserved"
             [class.standard]="!place.reserved && place.type === 'standard'"
             [class.premium]="!place.reserved && place.type === 'premium'"
             [class.handicap]="!place.reserved && place.type === 'handicap'"
             (click)="selectPlace(place)">
          <div class="space-number">{{ place.name }}</div>
          <div class="space-price" *ngIf="!place.reserved">{{ place.price }} TND/h</div>
          <mat-icon class="reserved-icon" *ngIf="place.reserved">lock</mat-icon>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <button mat-stroked-button color="warn" (click)="reset()">
        <mat-icon>refresh</mat-icon> Réinitialiser
      </button>
      <button mat-raised-button color="primary" (click)="nextStep()" [disabled]="!placeSelected">
        Suivant <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>
  </div>

  <!-- Step 2: Reservation Details -->
  <div *ngIf="currentStep === 2" class="step-content">
    <form [formGroup]="reservationForm" class="form-section">
      <div class="form-grid">
        <mat-form-field appearance="outline">
          <mat-label>Date de réservation</mat-label>
          <input matInput formControlName="date" [matDatepicker]="picker">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-icon matPrefix>calendar_today</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Heure de début</mat-label>
          <input matInput formControlName="heureDebut" type="time">
          <mat-icon matPrefix>access_time</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Heure de fin</mat-label>
          <input matInput formControlName="heureFin" type="time">
          <mat-icon matPrefix>access_time</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Véhicule (Immatriculation)</mat-label>
          <input matInput formControlName="vehicle" placeholder="ex: 123TU1234">
          <mat-icon matPrefix>directions_car</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" type="email">
          <mat-icon matPrefix>email</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Téléphone</mat-label>
          <input matInput formControlName="phone" type="tel">
          <mat-icon matPrefix>phone</mat-icon>
        </mat-form-field>
      </div>

      <div class="summary-card">
        <h4>Récapitulatif</h4>
        <div class="summary-item">
          <span>Place sélectionnée:</span>
          <strong>{{ availablePlaces.find(p => p.selected)?.name || 'Aucune' }}</strong>
        </div>
        <div class="summary-item">
          <span>Type:</span>
          <strong>{{ getPlaceTypeLabel(availablePlaces.find(p => p.selected)?.type) }}</strong>
        </div>
        <div class="summary-item">
          <span>Tarif horaire:</span>
          <strong>{{ availablePlaces.find(p => p.selected)?.price || '0' }} TND/h</strong>
        </div>
        <div class="summary-item total">
          <span>Total estimé:</span>
          <strong>{{ calculatedMontant }} TND</strong>
        </div>
      </div>

      <div class="action-buttons">
        <button mat-stroked-button type="button" (click)="prevStep()">
          <mat-icon>arrow_back</mat-icon> Retour
        </button>
        <button mat-raised-button color="primary" type="button" (click)="nextStep()" 
                [disabled]="reservationForm.invalid">
          Suivant <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
    </form>
  </div>

  <!-- Step 3: Confirmation -->
  <div *ngIf="currentStep === 3" class="step-content confirmation">
    <div class="confirmation-card">
      <mat-icon class="confirmation-icon">check_circle</mat-icon>
      <h3>Vérifiez votre réservation</h3>
      
      <div class="confirmation-details">
        <div class="detail-item">
          <mat-icon>place</mat-icon>
          <span>Place: <strong>{{ availablePlaces.find(p => p.selected)?.name }}</strong></span>
        </div>
        <div class="detail-item">
          <mat-icon>date_range</mat-icon>
          <span>Date: <strong>{{ reservationForm.get('date')?.value | date:'dd/MM/yyyy' }}</strong></span>
        </div>
        <div class="detail-item">
          <mat-icon>schedule</mat-icon>
          <span>Heure: <strong>{{ reservationForm.get('heureDebut')?.value }} - {{ reservationForm.get('heureFin')?.value }}</strong></span>
        </div>
        <div class="detail-item">
          <mat-icon>directions_car</mat-icon>
          <span>Véhicule: <strong>{{ reservationForm.get('vehicle')?.value }}</strong></span>
        </div>
        <div class="detail-item total">
          <mat-icon>payments</mat-icon>
          <span>Total: <strong>{{ calculatedMontant }} TND</strong></span>
        </div>
      </div>

      <div class="action-buttons">
        <button mat-stroked-button (click)="prevStep()">
          <mat-icon>arrow_back</mat-icon> Modifier
        </button>
        <button mat-raised-button color="primary" (click)="submitReservation()">
          <mat-icon>check</mat-icon> Confirmer la réservation
        </button>
      </div>
    </div>
  </div>
</div>
