<div class="sidebar flex flex-col w-64 bg-primary-purple text-white fixed h-[100vh] z-20 md:static transition-transform duration-300 ease-in-out" 
     [ngClass]="{'-translate-x-full': !(isSidebarOpen$ | async) && isMobile, 'translate-x-0': (isSidebarOpen$ | async) || !isMobile}" 
     *ngIf="isLoggedIn$ | async">
  <div class="flex items-center justify-between h-14 px-3 border-b border-dark-purple">
    <div class="flex items-center space-x-1">
      <i class="ri-parking-box-fill text-gold-500 text-xl"></i>
      <span class="text-lg font-bold font-display">Parkiny</span>
    </div>
    <button class="md:hidden text-white" (click)="toggleSidebar()">
      <i class="ri-close-line text-lg"></i>
    </button>
  </div>
  <div class="flex flex-col flex-grow p-1">
    <nav class="space-y-0">
      <div class="mt-2">
        <p class="px-2 text-[10px] font-semibold text-gray-300 uppercase tracking-wider">Navigation</p>
        <a routerLink="/dashboard" routerLinkActive="bg-dark-purple text-white" [routerLinkActiveOptions]="{ exact: true }" 
           class="flex items-center px-2 py-0.5 text-xs font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white mt-0.5 transition-colors">
          <i class="ri-dashboard-fill mr-1 text-gold-500 text-sm"></i>
          Tableau de bord
        </a>
        <a routerLink="/dashboard/reservations" routerLinkActive="bg-dark-purple text-white" 
           class="flex items-center px-2 py-0.5 text-xs font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white mt-0.5 transition-colors">
          <i class="ri-calendar-check-fill mr-1 text-gold-500 text-sm"></i>
          Réservations
        </a>
        <a routerLink="/dashboard/subscriptions" routerLinkActive="bg-dark-purple text-white" 
           class="flex items-center px-2 py-0.5 text-xs font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white mt-0.5 transition-colors">
          <i class="ri-bill-fill mr-1 text-gold-500 text-sm"></i>
          Abonnements
        </a>
        <div class="mt-0.5">
          <button (click)="toggleProfileMenu()" class="flex items-center w-full px-2 py-0.5 text-xs font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white transition-colors"
                  [ngClass]="{'bg-dark-purple text-white': isProfileMenuOpen}">
            <i class="ri-user-fill mr-1 text-gold-500 text-sm"></i>
            Profil
            <i class="ri-arrow-down-s-line ml-auto text-sm" [ngClass]="{'rotate-180': isProfileMenuOpen}"></i>
          </button>
          <div *ngIf="isProfileMenuOpen" class="space-y-0 pl-4">
            <a routerLink="/dashboard/profile/info" routerLinkActive="bg-dark-purple text-white" 
               class="block px-2 py-0.5 text-[10px] font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white transition-colors">
              Informations
            </a>
            <a routerLink="/dashboard/profile/password" routerLinkActive="bg-dark-purple text-white" 
               class="block px-2 py-0.5 text-[10px] font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white transition-colors">
              Mot de Passe
            </a>
            <a routerLink="/dashboard/profile/vehicles" routerLinkActive="bg-dark-purple text-white" 
               class="block px-2 py-0.5 text-[10px] font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white transition-colors">
              Véhicules
            </a>
            <a routerLink="/dashboard/profile/subscription" routerLinkActive="bg-dark-purple text-white" 
               class="block px-2 py-0.5 text-[10px] font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white transition-colors">
              Abonnement
            </a>
            <a routerLink="/dashboard/profile/history" routerLinkActive="bg-dark-purple text-white" 
               class="block px-2 py-0.5 text-[10px] font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white transition-colors">
              Historique des Réservations
            </a>
          </div>
        </div>
        <a routerLink="/dashboard/settings" routerLinkActive="bg-dark-purple text-white" 
           class="flex items-center px-2 py-0.5 text-xs font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white mt-0.5 transition-colors">
          <i class="ri-settings-3-fill mr-1 text-gold-500 text-sm"></i>
          Paramètres
        </a>
        <a routerLink="/dashboard/spot-status" routerLinkActive="bg-dark-purple text-white" 
           class="flex items-center px-2 py-0.5 text-xs font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white mt-0.5 transition-colors">
          <i class="ri-road-map-fill mr-1 text-gold-500 text-sm"></i>
          Statut des places
        </a>
        <a routerLink="/dashboard/notifications" routerLinkActive="bg-dark-purple text-white" 
           class="flex items-center px-2 py-0.5 text-xs font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white mt-0.5 transition-colors">
          <i class="ri-notification-3-fill mr-1 text-gold-500 text-sm"></i>
          Notifications
        </a>
        <a (click)="logout()" class="flex items-center px-2 py-0.5 text-xs font-medium rounded-md text-gray-300 hover:bg-dark-purple hover:text-white mt-0.5 transition-colors cursor-pointer">
          <i class="ri-logout-box-r-line mr-1 text-gold-500 text-sm"></i>
          Déconnexion
        </a>
      </div>
    </nav>
  </div>
  <div class="p-1 border-t border-dark-purple">
    <div class="flex items-center">
      <div class="w-8 h-8 rounded-full bg-dark-purple text-gold-500 flex items-center justify-center text-xs font-medium gold-glow">
        {{ userInitials || 'UN' }}
      </div>
      <div class="ml-1">
        <p class="text-xs font-medium text-white">{{ userName || 'Utilisateur' }}</p>
        <p class="text-[10px] font-medium text-gray-300">{{ subscriptionType || 'Membre' }}</p>
      </div>
    </div>
  </div>
</div>

<button *ngIf="(isLoggedIn$ | async) && (isMobile$ | async) && !(isSidebarOpen$ | async)" (click)="toggleSidebar()" 
        class="md:hidden fixed top-4 left-4 z-30 text-primary-purple bg-gold-500 p-2 rounded-md">
  <i class="ri-menu-line text-xl"></i>
</button>