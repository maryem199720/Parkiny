<div class="sidebar flex flex-col w-64 bg-gradient-to-b from-primary-purple to-dark-purple text-white fixed h-[100vh] z-20 transition-all duration-300 ease-in-out"
     [ngClass]="{'w-16': isCollapsed, '-translate-x-full': !(isSidebarOpen$ | async) && isMobile, 'translate-x-0': (isSidebarOpen$ | async) || !isMobile}"
     *ngIf="isLoggedIn$ | async">
  <div class="flex items-center justify-between h-14 px-3 border-b border-dark-purple/50">
    <div class="flex items-center space-x-2">
      <i class="ri-parking-box-fill text-gold-500 text-xl"></i>
      <span class="text-lg font-bold font-display" [ngClass]="{'hidden': isCollapsed}">Parkiny</span>
    </div>
    <button class="md:hidden text-white" (click)="toggleSidebar()">
      <i class="ri-close-line text-lg"></i>
    </button>
    <button class="hidden md:block text-white" (click)="toggleCollapse()">
      <i class="ri-menu-fold-line text-lg" [ngClass]="{'ri-menu-unfold-line': isCollapsed}"></i>
    </button>
  </div>
  <div class="flex flex-col flex-grow p-2 overflow-y-auto scrollbar-thin scrollbar-thumb-dark-purple scrollbar-track-primary-purple/50">
    <nav class="space-y-1">
      <div>
        <p class="px-2 text-xs font-semibold text-white/80 uppercase tracking-wider" [ngClass]="{'hidden': isCollapsed}">Navigation</p>
        <a routerLink="/dashboard" routerLinkActive="bg-dark-purple text-white" [routerLinkActiveOptions]="{ exact: true }" 
           class="flex items-center px-2 py-1 text-sm font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors"
           [ngClass]="{'justify-center': isCollapsed}">
          <i class="ri-dashboard-fill mr-2 text-gold-500 text-base"></i>
          <span [ngClass]="{'hidden': isCollapsed}">Tableau de bord</span>
        </a>
        <a routerLink="/dashboard/reservations" routerLinkActive="bg-dark-purple text-white" 
           class="flex items-center px-2 py-1 text-sm font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors"
           [ngClass]="{'justify-center': isCollapsed}">
          <i class="ri-calendar-check-fill mr-2 text-gold-500 text-base"></i>
          <span [ngClass]="{'hidden': isCollapsed}">Réservations</span>
        </a>
        <a routerLink="/dashboard/subscriptions" routerLinkActive="bg-dark-purple text-white" 
           class="flex items-center px-2 py-1 text-sm font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors"
           [ngClass]="{'justify-center': isCollapsed}">
          <i class="ri-bill-fill mr-2 text-gold-500 text-base"></i>
          <span [ngClass]="{'hidden': isCollapsed}">Abonnements</span>
        </a>
        <div>
          <button (click)="toggleProfileMenu()" 
                  class="flex items-center w-full px-2 py-1 text-sm font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors"
                  [ngClass]="{'bg-dark-purple text-white': isProfileMenuOpen, 'justify-center': isCollapsed}">
            <i class="ri-user-fill mr-2 text-gold-500 text-base"></i>
            <span [ngClass]="{'hidden': isCollapsed}">Profil</span>
            <i class="ri-arrow-down-s-line ml-auto text-base" [ngClass]="{'rotate-180': isProfileMenuOpen, 'hidden': isCollapsed}"></i>
          </button>
          <div *ngIf="isProfileMenuOpen && !isCollapsed" class="space-y-1 pl-4">
            <a routerLink="/dashboard/profile/info" routerLinkActive="bg-dark-purple text-white" 
               class="block px-2 py-1 text-xs font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors">
              Informations
            </a>
            <a routerLink="/dashboard/profile/password" routerLinkActive="bg-dark-purple text-white" 
               class="block px-2 py-1 text-xs font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors">
              Mot de Passe
            </a>
            <a routerLink="/dashboard/profile/vehicles" routerLinkActive="bg-dark-purple text-white" 
               class="block px-2 py-1 text-xs font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors">
              Véhicules
            </a>
            <a routerLink="/dashboard/profile/subscription" routerLinkActive="bg-dark-purple text-white" 
               class="block px-2 py-1 text-xs font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors">
              Abonnement
            </a>
            <a routerLink="/dashboard/profile/history" routerLinkActive="bg-dark-purple text-white" 
               class="block px-2 py-1 text-xs font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors">
              Historique des Réservations
            </a>
          </div>
        </div>
        <a routerLink="/dashboard/settings" routerLinkActive="bg-dark-purple text-white" 
           class="flex items-center px-2 py-1 text-sm font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors"
           [ngClass]="{'justify-center': isCollapsed}">
          <i class="ri-settings-3-fill mr-2 text-gold-500 text-base"></i>
          <span [ngClass]="{'hidden': isCollapsed}">Paramètres</span>
        </a>
        <a routerLink="/dashboard/spot-status" routerLinkActive="bg-dark-purple text-white" 
           class="flex items-center px-2 py-1 text-sm font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors"
           [ngClass]="{'justify-center': isCollapsed}">
          <i class="ri-road-map-fill mr-2 text-gold-500 text-base"></i>
          <span [ngClass]="{'hidden': isCollapsed}">Statut des places</span>
        </a>
        <a (click)="logout()" 
           class="flex items-center px-2 py-1 text-sm font-medium rounded-md text-white/80 hover:bg-dark-purple hover:text-white transition-colors cursor-pointer"
           [ngClass]="{'justify-center': isCollapsed}">
          <i class="ri-logout-box-r-line mr-2 text-gold-500 text-base"></i>
          <span [ngClass]="{'hidden': isCollapsed}">Déconnexion</span>
        </a>
      </div>
    </nav>
  </div>
  <div class="p-2 border-t border-dark-purple/50">
    <div class="flex items-center">
      <div class="w-8 h-8 rounded-full bg-dark-purple text-gold-500 flex items-center justify-center text-sm font-medium gold-glow">
        {{ userInitials || 'UN' }}
      </div>
      <div class="ml-2" [ngClass]="{'hidden': isCollapsed}">
        <p class="text-sm font-medium text-white">{{ userName || 'Utilisateur' }}</p>
        <p class="text-xs font-medium text-white/80">{{ subscriptionType || 'Membre' }}</p>
      </div>
    </div>
  </div>
</div>

<button *ngIf="(isLoggedIn$ | async) && (isMobile$ | async) && !(isSidebarOpen$ | async)" (click)="toggleSidebar()" 
        class="md:hidden fixed top-4 left-4 z-30 text-white bg-primary-purple p-2 rounded-md">
  <i class="ri-menu-line text-xl"></i>
</button>