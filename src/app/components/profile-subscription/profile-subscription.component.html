<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">Gestion des Abonnements</h1>

  @if (isLoading()) {
    <mat-spinner class="mx-auto"></mat-spinner>
  } @else {
    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Abonnement Actif</h2>
      @if (subscription(); as sub) {
        <div class="bg-white shadow-md rounded-lg p-4">
          <p>Type: {{ sub.subscriptionType }}</p>
          <p>Statut: {{ sub.status }}</p>
          <p>Places restantes: {{ sub.remainingPlaces }}</p>
          <p>Début: {{ sub.startDate | date:'d MMM yyyy' }}</p>
          <p>Fin: {{ sub.endDate | date:'d MMM yyyy' }}</p>
        </div>
      } @else {
        <p class="text-gray-600">Aucun abonnement actif.</p>
      }
    </div>

    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Historique des Abonnements</h2>
      <div class="flex flex-col sm:flex-row gap-4 mb-4">
        <mat-form-field appearance="outline" class="w-48">
          <mat-label>Mois et Année</mat-label>
          <input matInput [matDatepicker]="picker" [(ngModel)]="selectedDate" class="input-field" (dateChange)="onMonthSelected($event.value)" placeholder="Sélectionner une date" />
          <mat-datepicker-toggle matIconSuffix [for]="picker">
            <mat-icon matDatepickerToggleIcon class="text-primary-purple">calendar_month</mat-icon>
          </mat-datepicker-toggle>
          <mat-datepicker #picker startView="year" (monthSelected)="onMonthSelected($event)" panelClass="compact-datepicker"></mat-datepicker>
        </mat-form-field>
        <button mat-raised-button class="btn-primary px-6 py-2" (click)="applyFilters()">Appliquer</button>
        <button mat-raised-button class="btn-secondary px-6 py-2" (click)="resetFilters()">Réinitialiser</button>
      </div>

      @if (subscriptionHistory().length === 0) {
        <p class="text-gray-600">Aucun historique disponible.</p>
      } @else {
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          @for (sub of subscriptionHistory(); track sub.id) {
            <div class="bg-white shadow-md rounded-lg p-4 relative">
              <p>Type: {{ sub.subscriptionType }}</p>
              <p>Statut: {{ sub.status }}</p>
              <p>Places: {{ sub.remainingPlaces }}</p>
              <p>Début: {{ sub.startDate | date:'d MMM yyyy' }}</p>
              <p>Fin: {{ sub.endDate | date:'d MMM yyyy' }}</p>
              <button mat-icon-button class="absolute top-2 right-2 text-primary-purple hover:text-dark-purple" (click)="deleteSubscription(sub.id)" title="Supprimer">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          }
        </div>
      }
    </div>

    @if (errorMessage()) {
      <div class="error-message-container">
        {{ errorMessage() }}
      </div>
    }
  }
</div>